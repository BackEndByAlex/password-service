stages:
  - build

variables:
  IMAGE_TAG: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG

build-image:
  stage: build
  image:
    name: gcr.io/kaniko-project/executor:v1.23.2-debug
    entrypoint: [""]  
  before_script:
    # .env från File-variabeln
    - cp "$DOTENV_FILE" "$CI_PROJECT_DIR/.env"
    # använder PUBLIC_PEM:
    - cp "$PUBLIC_PEM" "$CI_PROJECT_DIR/public.pem"
  script:
    - /kaniko/executor --context=$CI_PROJECT_DIR --dockerfile=$CI_PROJECT_DIR/Dockerfile --destination=$IMAGE_TAG --verbosity=debug
